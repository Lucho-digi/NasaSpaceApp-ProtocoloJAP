<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Rain Check</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .status {
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #0056b3;
        }
        pre {
            background: #272822;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            max-height: 400px;
        }
        h1 { color: #333; }
        h2 { color: #666; margin-top: 30px; }
        .mode-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 10px;
        }
        .mode-mock {
            background: #ffc107;
            color: #000;
        }
        .mode-api {
            background: #28a745;
            color: white;
        }
    </style>
</head>
<body>
    <h1>üå¶Ô∏è Rain Check - Testing Dashboard</h1>
    
    <div id="mode-display" class="info">
        <strong>Current Mode:</strong> <span id="current-mode" class="mode-indicator">Loading...</span>
    </div>

    <h2>Quick Navigation</h2>
    <div>
        <button onclick="window.location.href='index.html'">üìç Main Page (Home)</button>
        <button onclick="window.location.href='pages/today.html'">üìÖ Today's Weather</button>
        <button onclick="window.location.href='pages/week.html'">üìä Weekly Forecast</button>
    </div>

    <h2>API Tests</h2>
    <div>
        <button onclick="testCurrentWeather()">Test Current Weather API</button>
        <button onclick="testWeeklyForecast()">Test Weekly Forecast API</button>
        <button onclick="testNavigation()">Test Week ‚Üí Today Navigation</button>
    </div>

    <div id="test-results"></div>

    <h2>How to Change Mode</h2>
    <div class="info">
        <p><strong>To use MOCK data (no backend needed):</strong></p>
        <p>Edit <code>js/config.js</code> and set: <code>USE_MOCK_DATA: true</code></p>
        
        <p style="margin-top: 15px;"><strong>To use REAL API (backend required):</strong></p>
        <p>Edit <code>js/config.js</code> and set: <code>USE_MOCK_DATA: false</code></p>
        
        <p style="margin-top: 15px;"><strong>Backend CORS Configuration:</strong></p>
        <p>See <code>SOLUCION_CORS_Y_MOCK.md</code> for FastAPI setup instructions</p>
    </div>

    <h2>Instructions</h2>
    <div class="info">
        <ol>
            <li><strong>Start a local server:</strong>
                <pre>cd Front
python -m http.server 8080</pre>
            </li>
            <li><strong>Open in browser:</strong> <code>http://localhost:8080/test-system.html</code></li>
            <li><strong>Click buttons above</strong> to test functionality</li>
            <li><strong>Check browser console (F12)</strong> for detailed logs</li>
        </ol>
    </div>

    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script>
        // Display current mode
        const modeEl = document.getElementById('current-mode');
        const USE_MOCK = typeof API_CONFIG !== 'undefined' ? API_CONFIG.USE_MOCK_DATA : true;
        
        if (USE_MOCK) {
            modeEl.textContent = 'üì¶ MOCK DATA (Example JSON)';
            modeEl.className = 'mode-indicator mode-mock';
        } else {
            modeEl.textContent = 'üåê REAL API (Backend Required)';
            modeEl.className = 'mode-indicator mode-api';
        }

        function showResult(title, success, message, data = null) {
            const resultsDiv = document.getElementById('test-results');
            const statusClass = success ? 'success' : 'error';
            
            let html = `
                <div class="status ${statusClass}">
                    <h3>${success ? '‚úÖ' : '‚ùå'} ${title}</h3>
                    <p>${message}</p>
            `;
            
            if (data) {
                html += `<pre>${JSON.stringify(data, null, 2).substring(0, 500)}...</pre>`;
            }
            
            html += '</div>';
            resultsDiv.innerHTML = html + resultsDiv.innerHTML;
        }

        async function testCurrentWeather() {
            console.log('Testing current weather API...');
            
            try {
                const location = WeatherUtils.getStoredLocation();
                const data = await WeatherAPI.fetchWeatherData(location.latitude, location.longitude);
                
                if (data) {
                    showResult(
                        'Current Weather API',
                        true,
                        `Successfully loaded weather data for ${data.location.place_name}`,
                        data
                    );
                } else {
                    showResult(
                        'Current Weather API',
                        false,
                        'Failed to load weather data'
                    );
                }
            } catch (error) {
                showResult(
                    'Current Weather API',
                    false,
                    `Error: ${error.message}`
                );
            }
        }

        async function testWeeklyForecast() {
            console.log('Testing weekly forecast API...');
            
            try {
                const location = WeatherUtils.getStoredLocation();
                const data = await WeatherAPI.fetchWeeklyForecast(location.latitude, location.longitude);
                
                if (data && data.length > 0) {
                    showResult(
                        'Weekly Forecast API',
                        true,
                        `Successfully loaded ${data.length} days of forecast`,
                        data[0]
                    );
                } else {
                    showResult(
                        'Weekly Forecast API',
                        false,
                        'Failed to load weekly forecast'
                    );
                }
            } catch (error) {
                showResult(
                    'Weekly Forecast API',
                    false,
                    `Error: ${error.message}`
                );
            }
        }

        function testNavigation() {
            const testDate = '2025-10-08';
            const location = WeatherUtils.getStoredLocation();
            const url = `pages/today.html?date=${testDate}&lat=${location.latitude}&lon=${location.longitude}`;
            
            showResult(
                'Week ‚Üí Today Navigation',
                true,
                `Navigation URL generated successfully. Click below to test:`,
                { url: url }
            );
            
            setTimeout(() => {
                if (confirm('Open today.html with test parameters?')) {
                    window.location.href = url;
                }
            }, 1000);
        }

        // Auto-run basic test on load
        window.addEventListener('load', () => {
            console.log('='.repeat(50));
            console.log('Rain Check - System Test Dashboard');
            console.log('='.repeat(50));
            console.log('Current Mode:', USE_MOCK ? 'MOCK DATA' : 'REAL API');
            console.log('API Base URL:', typeof API_CONFIG !== 'undefined' ? API_CONFIG.BASE_URL : 'Not configured');
            console.log('='.repeat(50));
        });
    </script>
</body>
</html>
